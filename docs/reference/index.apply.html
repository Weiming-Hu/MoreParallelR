<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>MoreParallelR::index.apply — index.apply • MoreParallelR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="MoreParallelR::index.apply — index.apply" />
<meta property="og:description" content="MoreParallelR::index.apply makes it convenient to parallel
processing with multiple arrays. Sometimes, the parallelization
becomes hard because you need to access index (positions)
during the process. This function is designed specifically
for this situation." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MoreParallelR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>MoreParallelR::index.apply</h1>
    
    <div class="hidden name"><code>index.apply.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>MoreParallelR::index.apply makes it convenient to parallel
processing with multiple arrays. Sometimes, the parallelization
becomes hard because you need to access index (positions)
during the process. This function is designed specifically
for this situation.</p>
    </div>

    <pre class="usage"><span class='fu'>index.apply</span>(<span class='no'>X</span>, <span class='no'>MARGIN</span>, <span class='no'>FUN</span>, <span class='no'>...</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>debug</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>progress.bar</span> <span class='kw'>=</span> <span class='no'>F</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>A list of arrays or matrices.</p></td>
    </tr>
    <tr>
      <th>MARGIN</th>
      <td><p>A vector giving the subscripts which the
function will be applied over. Slices from all elements
in the input list <code>X</code> will be created.</p></td>
    </tr>
    <tr>
      <th>FUN</th>
      <td><p>The function to be applied. The first argument
of this function should take a member from the list that is
constructed internally by this function. Please use
<code>debug = T</code> to examine this internally constructed list.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments to <code>FUN</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Whether to print progress information.</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>Set this to TRUE to return the internally
constructed list. This is helpful when you are designing
your function.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>The number of cores for parallelization.</p></td>
    </tr>
    <tr>
      <th>progress.bar</th>
      <td><p>Whether to show a progress bar.
This requires the package <code>pbmcapply</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An array.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The way this has been done is that a list of arrays are
expected from the user and the MARGIN dimensions should be
identical because those are the dimensions to be partitioned.
All members in the list will be partitioned and put into
a separate list. The first member in this list is the
corresponding index for the MARGIN dimensions and the
subsequent members in this list are the input partitioned arrays.</p>
<p>The difficulty might be how to write FUN. It should be
a function which takes one list with the partitioned arrays
and any other extra arguments. If you want to examine
the partitioned list, it is suggested to use <code>debug = T</code> before
you write your FUN.</p>
<p>To see better improvement by the parallelization, it is
preferred to have the runtime of <code>FUN</code> longer. In other
words, this solution works better when you have a heavy
workload in the function <code>FUN</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Imagine that you have 2 arrays with different dimensions.</span>
<span class='no'>a1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>1</span>:<span class='fl'>1000</span>, <span class='kw'>dim</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>10</span>, <span class='fl'>5</span>, <span class='fl'>20</span>))
<span class='no'>a2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>1</span>:<span class='fl'>2000</span>, <span class='kw'>dim</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>20</span>))

<span class='co'># You have a constant which will be involved</span>
<span class='co'># during the calculation.</span>
<span class='co'>#</span>
<span class='no'>c</span> <span class='kw'>&lt;-</span>  <span class='fl'>5.5</span>

<span class='co'># You have a function that you would like to iterate</span>
<span class='co'># on the first and third dimensions of the arrays.</span>
<span class='co'>#</span>
<span class='no'>foo</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>c</span>) {
  <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>x</span>) + <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>y</span>) + <span class='no'>c</span>)
}

<span class='co'># To write the sequential version, we need to preallocate</span>
<span class='co'># a new array and the required memory.</span>
<span class='co'>#</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>NA</span>, <span class='kw'>dim</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>10</span>, <span class='fl'>20</span>))

<span class='co'># We need to write a nested for loop because we want</span>
<span class='co'># to apply the function on two arrays based on the iteration</span>
<span class='co'># on the first and the third dimensions.</span>
<span class='co'>#</span>
<span class='kw'>for</span> (<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>10</span>) {
  <span class='kw'>for</span> (<span class='no'>j</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>20</span>) {
    <span class='no'>d</span>[<span class='no'>i</span>, <span class='no'>j</span>] <span class='kw'>&lt;-</span> <span class='fu'>foo</span>(<span class='no'>a1</span>[<span class='no'>i</span>, , <span class='no'>j</span>], <span class='no'>a2</span>[<span class='no'>i</span>, , <span class='no'>j</span>], <span class='no'>c</span>)
  }
}

<span class='co'># To use the index.apply function, we need to put</span>
<span class='co'># our arrays in a list.</span>
<span class='co'>#</span>
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>a1</span>, <span class='no'>a2</span>)

<span class='co'># Define our margin</span>
<span class='no'>MARGIN</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>3</span>)

<span class='co'># Define the functions. The first argument should be</span>
<span class='co'># an element from the list which you can get by running</span>
<span class='co'># the following code with `debug = T`.</span>
<span class='co'>#</span>
<span class='no'>internal.list</span> <span class='kw'>&lt;-</span> <span class='fu'>index.apply</span>(<span class='no'>X</span>, <span class='no'>MARGIN</span>, <span class='fl'>4</span>, <span class='kw'>NULL</span>, <span class='kw'>debug</span> <span class='kw'>=</span> <span class='no'>T</span>)

<span class='co'># The returned value is a list with length of 200, because</span>
<span class='co'># the iteration is carried out on the first (length of 10)</span>
<span class='co'># and third (length of 20) dimensions. Each element in this</span>
<span class='co'># list will be fed into the function as the first argument.</span>
<span class='co'># So you should take a look at the element in order to design</span>
<span class='co'># your function accordingly.</span>
<span class='co'>#</span>
<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>internal.list</span>)</div><div class='output co'>#&gt; [1] 200</div><div class='input'>
<span class='co'># Each element is a list with the iteration index as the</span>
<span class='co'># first member, and then the sliced arrays/matrices with</span>
<span class='co'># these indices as the following members.</span>
<span class='co'>#</span>
<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>internal.list</span><span class='kw'>[[</span><span class='fl'>1</span>]])</div><div class='output co'>#&gt; [1] 3</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>internal.list</span><span class='kw'>[[</span><span class='fl'>1</span>]])</div><div class='output co'>#&gt; [1] "index"  "array1" "array2"</div><div class='input'>
<span class='co'># Therefore, we design our function accordingly.</span>
<span class='no'>FUN</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>l</span>, <span class='no'>c</span>) {
  <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>l</span><span class='kw'>[[</span><span class='fl'>2</span>]]) + <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>l</span><span class='kw'>[[</span><span class='fl'>3</span>]]) + <span class='no'>c</span>)}

<span class='co'># Run the same calculation with index.apply.</span>
<span class='no'>d.new</span> <span class='kw'>&lt;-</span> <span class='fu'>index.apply</span>(<span class='no'>X</span>, <span class='no'>MARGIN</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>FUN</span>, <span class='kw'>c</span> <span class='kw'>=</span> <span class='no'>c</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fl'>2</span>)

<span class='co'># Check</span>
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>d</span>, <span class='no'>d.new</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Weiming Hu</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://weiming.ddns.net'>Weiming Hu</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


